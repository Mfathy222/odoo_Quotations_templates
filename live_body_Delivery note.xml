<!-- Delivery note live_body  -->

<t t-name="stock.report_delivery_document">
        <t t-call="web.html_container">
            <t t-call="web.external_layout">
                <t t-set="o" t-value="o.with_context(lang=o._get_report_lang())"/>
                <t t-set="partner" t-value="o.partner_id or (o.move_ids and o.move_ids[0].partner_id) or False"/>

                <t t-set="address">
                    <div name="div_outgoing_address">
                        <div name="outgoing_delivery_address" t-if="o.should_print_delivery_address()">
                            <div t-out="o.move_ids[0].partner_id or o.partner_id" t-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;address&quot;, &quot;name&quot;, &quot;phone&quot;], &quot;no_marker&quot;: True, &quot;phone_icons&quot;: True}"/>
                        </div>
                        <div name="outgoing_warehouse_address" t-elif="o.picking_type_id.code != 'internal' and o.picking_type_id.warehouse_id.partner_id">
                            <strong>Warehouse Address</strong>
                            <div t-field="o.picking_type_id.warehouse_id.partner_id" t-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;address&quot;, &quot;name&quot;, &quot;phone&quot;], &quot;no_marker&quot;: True, &quot;phone_icons&quot;: True}"/>
                        </div>
                    </div>
                </t>
                 <!--بلوك معلومات إضافية (Vendor / Customer) -->
                <t t-set="information_block">
                    <div class="row">
                        <div class="col-7" name="div_incoming_address">
                            <t t-set="show_partner" t-value="False"/>
                            <div name="vendor_address" t-if="o.picking_type_id.code=='incoming' and partner">
                                <strong>Vendor Address</strong>
                                <t t-set="show_partner" t-value="True"/>
                            </div>
                            <div name="customer_address" t-if="o.picking_type_id.code=='outgoing' and partner and partner != partner.commercial_partner_id">
                                <strong>Customer Address</strong>
                                <t t-set="show_partner" t-value="True"/>
                            </div>
                            <div t-if="show_partner" name="partner_header">
                                <div t-field="partner.commercial_partner_id" t-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;address&quot;, &quot;name&quot;, &quot;phone&quot;, &quot;vat&quot;], &quot;no_marker&quot;: True, &quot;phone_icons&quot;: True}"/>
                            </div>
                        </div>
                    </div>
                </t>
                <div class="page">
                    <!--<h2 style="margin-top: 15px;">-->
                    <!--    <span t-out="o.picking_type_id._get_code_report_name()"/>-->
                    <!--    <span t-field="o.name">WH/OUT/0001</span>-->
                    <!--</h2>-->
                    <div class="oe_structure"/>
                    <div id="informations" class="report-wrapping-flexbox clearfix row mb-4">
                        <div t-if="o.origin" class="col col-3 mw-100 mb-2" name="div_origin">
                            <!--<strong>Order</strong>-->
                            <!--<div t-field="o.origin" class="m-0">S0001</div>-->
                        </div>
                        <div t-if="o.picking_type_id.code == 'internal' and o.partner_id" class="col col-3 mw-100 mb-2" name="div_contact">
                            <strong>Contact</strong>
                            <div t-field="o.partner_id" class="m-0"/>
                        </div>
                        <div t-if="o.state" class="col col-3 mw-100 mb-2" name="div_sched_date">
                            <!--<strong>Shipping Date</strong>-->
                            <!--<div t-if="o.state == 'done'" t-field="o.date_done" class="m-0"/>-->
                            <!--<div t-else="" t-field="o.scheduled_date" class="m-0"/>-->
                        </div>
                        <div t-if="o.user_id" class="col-auto" name="div_operator">
                            <strong>Operator:</strong>
                                <p t-field="o.user_id">Mitchel Admin</p>
                        </div>
                    </div>
                     <!-- ستايل بلوك العميل (نفس الكوتيشن) -->
                <style>
                    table.o_main_table,
                    table.o_main_table &gt; tbody &gt; tr &gt; td {
                        border: none !important;
                    }
                    .article.o_report_layout_standard,
                    .article.o_report_layout_standard .page {
                        border: none !important;
                        box-shadow: none !important;
                    }
                    .ss-header-table { width:100%; border-collapse:collapse;}
                    .ss-box       { border:1px solid #000; padding:2px 6px; font-size:12px; font-weight:bold; display:inline-block; }
                    .ss-line      { border-top:2px solid #000; margin:4px 0; }
                    .ss-title-row { font-weight:bold; font-size:16px; }
                    .ss-block     { border:2px solid #000; border-radius:10px; padding:4px; }
                    .ss-block-title {
                        font-weight:bold;
                        text-align:center;
                        font-size:13px;
                        border-bottom:1px solid #000;
                        margin-bottom:4px;
                    }
                    .ss-main-top-table,
                    .ss-main-top-table tr,
                    .ss-main-top-table td {
                        border: none !important;
                        outline:none !important;
                    }
                    .ss-block-table {
                        width:100%;
                        font-size:14px;
                        border-collapse:separate;
                        border-spacing:0 3px;
                        border:none !important;
                        outline:none !important;
                    }
                    .ss-block-table tr,
                    .ss-block-table td {
                        padding:1px 2px;
                        border:none !important;
                        outline:none !important;
                    }
                    .ss-value-cell {
                        background-color:#F2EADC;
                        text-align:center;
                        padding:3px 4px;
                    }
                     tr,tbody {
                border:none !important;
                outline:none !important;
                }
                </style>

                <!-- بلوك بيانات العميل -->
                <table class="ss-main-top-table" style="width:100%; border-style:none !important;">
                    <tr>
                        <td style="width:60%; vertical-align:top; padding-right:6px;">
                            <div class="ss-bloc">
                                <table class="ss-block-table">
                                    <tr>
                                        <td style="width:5%; font-weight:bold; color:#0A27A1;">Name</td>
                                        <td class="ss-value-cell" style="width:90%;">
                                            <span t-esc="(o and o.partner_id.name and o.partner_id.name) or ''"/>
                                        </td>
                                        <td style="width:25%; text-align:right; direction:rtl; font-weight:bold; color:#0A27A1;">الاسم</td>
                                    </tr>
                                    <tr>
                                        <td style="font-weight:bold; color:#0A27A1;">Address</td>
                                        <td class="ss-value-cell" style="width:60%;">
                                            <span t-esc="(o and o.partner_id.city and o.partner_id.city) or ''"/>,
                                            <span t-esc="(o and o.partner_id.street and o.partner_id.street) or ''"/>,
                                            <span t-esc="(o and o.partner_id.street2 and o.partner_id.street2) or ''"/>
                                        </td>
                                        <td style="text-align:right; direction:rtl; font-weight:bold; color:#0A27A1;">العنوان</td>
                                    </tr>
                                    <tr>
                                        <td style="font-weight:bold; color:#0A27A1;">City</td>
                                        <td class="ss-value-cell" style="width:60%;">
                                            <span t-esc="(o and o.partner_id.city and o.partner_id.city) or ''"/>
                                        </td>
                                        <td style="text-align:right; direction:rtl; font-weight:bold; color:#0A27A1;">المدينة</td>
                                    </tr>
                                    <tr>
                                        <td style="font-weight:bold; color:#0A27A1;">Phone</td>
                                        <td class="ss-value-cell" style="width:60%;">
                                            <span t-esc="(o and o.partner_id.phone and o.partner_id.phone) or ''"/>
                                        </td>
                                        <td style="text-align:right; direction:rtl; font-weight:bold; color:#0A27A1;">الهاتف</td>
                                    </tr>
                                    <tr>
                                        <td style="font-weight:bold; color:#0A27A1;">E-Mail</td>
                                        <td class="ss-value-cell" style="width:60%;">
                                            <span t-esc="(o and o.partner_id.email and o.partner_id.email) or ''"/>
                                        </td>
                                        <td style="text-align:right; direction:rtl; font-weight:bold; color:#0A27A1;">الإيميل</td>
                                    </tr>
                                    <tr t-if="o and 'client_order_ref' in o._fields">
                                        <td style="font-weight:bold; color:#0A27A1;">Note</td>
                                        <td class="ss-value-cell" style="width:60%;">
                                            <span t-esc="o.x_studio_note or ''"/>
                                        </td>
                                        <td style="text-align:right; direction:rtl; font-weight:bold; color:#0A27A1;">ملاحظة</td>
                                    </tr>
                                </table>
                            </div>
                        </td>
                    </tr>
                </table>
                    <div class="oe_structure"/>
                    <t t-set="format_number" t-value="lambda x: int(x) if x == int(x) else x"/>
                    <!-- ====== DELIVERY ITEMS TABLE (SMART STYLE) ====== -->
                <style>
                    .dn-items-table {
                        width: 100%;
                        border-collapse: collapse;
                        font-size: 15px;
                        margin-top: 10px;
                    }
                    .dn-items-table th,
                    .dn-items-table td {
                        border: 2px solid #000;
                        padding: 4px 5px;
                    }
                    .dn-items-table thead th {
                        text-align: center;
                        background-color: #e6e6e6;
                    }
                    .dn-head-ar {
                        direction: rtl;
                        font-weight: bold;
                    }
                    .dn-head-en {
                        font-size: 12px;
                    }
                    .dn-col-code   { width: 18%; text-align: center;}
                    .dn-col-desc   { width: 52%; text-align: center;}
                    .dn-col-qty    { width: 10%; text-align: center; }
                    .dn-col-notes  { width: 20%; text-align: center;}
                    .dn-cell-code  { text-align: center; text-align: center;}
                    .dn-cell-qty   { text-align: center; white-space: nowrap; }
                    .dn-cell-notes { text-align: left; text-align: center;}
                </style>

                <table class="dn-items-table">
                    <thead>
                        <tr>
                            <!--<th class="dn-col-code">-->
                            <!--    <div class="dn-head-ar">رمز الصنف</div>-->
                            <!--    <div class="dn-head-en">Item code</div>-->
                            <!--</th>-->
                            <th class="dn-col-desc">
                                <div class="dn-head-ar">اسم الصنف</div>
                                <div class="dn-head-en">Description</div>
                            </th>
                            <th class="dn-col-qty">
                                <div class="dn-head-ar">الكمية</div>
                                <div class="dn-head-en">Qty</div>
                            </th>
                            <th class="dn-col-notes">
                                <div class="dn-head-ar">ملاحظات</div>
                                <div class="dn-head-en">Notes</div>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-set="lines" t-value="o.move_ids"/>
                        <tr t-foreach="lines" t-as="move">
                            <!-- Item code -->
                            <!--<td class="dn-cell-code">-->
                            <!--    <span t-esc="move.product_id.default_code or ''"/>-->
                            <!--</td>-->

                            <!-- Description -->
                            <td>
                                <div>
                                    <span t-field="move.product_id.display_name"/>
                                </div>
                                <div t-if="move.description_picking and move.description_picking != move.product_id.display_name">
                                    <span t-out="move.description_picking" t-options="{'widget': 'text'}"/>
                                </div>
                            </td>

                            <!-- Quantity (حسب حالة التحويل) -->
                            <td class="dn-cell-qty">
                                <t t-if="o.state == 'done'">
                                    <span t-out="format_number(move.quantity)" class="text-nowrap"/>
                                </t>
                                <t t-else="">
                                    <span t-out="format_number(move.product_uom_qty)" class="text-nowrap"/>
                                </t>
                                <span t-field="move.product_uom" groups="uom.group_uom"/>
                            </td>

                            <!-- Notes -->
                            <td class="dn-cell-notes">
                                <!-- ممكن تستخدم حقل معين هنا لو حابب -->
                            </td>
                        </tr>
                    </tbody>
                </table>

                <!-- باقى الكود الأصلى (الـ backorders + التوقيع) بدون أى تغيير -->

                    <div class="oe_structure"/>
                    <t t-set="backorders" t-value="o.backorder_ids.filtered(lambda x: x.state not in ('done', 'cancel'))"/>
                    <div t-if="not (o.backorder_ids and backorders)" class="oe_structure"/>
                    <div t-else="">
                        <p class="mt-5">
                            <span>Remaining quantities not yet delivered:</span>
                        </p>
                        <table class="table table-sm table-borderless" name="stock_backorder_table">
                            <thead>
                                <tr>
                                    <th name="th_sb_product"><strong>Product</strong></th>
                                    <th/>
                                    <th name="th_sb_quantity" class="text-end"><strong>Quantity</strong></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr t-foreach="backorders.mapped('move_ids').filtered(lambda x: x.product_uom_qty)" t-as="bo_line">
                                    <td class="w-auto">
                                        <span t-field="bo_line.product_id">Office Chair</span>
                                        <p t-if="bo_line.description_picking and bo_line.description_picking != bo_line.product_id.name and bo_line.description_picking != bo_line.product_id.display_name">
                                            <span t-out="bo_line.description_picking" t-options="{'widget': 'text'}">Description on transfer</span>
                                        </p>
                                    </td>
                                    <td/>
                                    <td class="text-end w-auto">
                                        <span t-out="format_number(bo_line.product_uom_qty)">3.00</span>
                                        <span t-field="bo_line.product_uom" groups="uom.group_uom">units</span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div t-if="not o.signature" class="oe_structure"/>
                    <div t-else="" class="mt32 ml64 mr4" name="signature">
                        <div class="offset-8">
                            <strong>Signature</strong>
                        </div>
                        <div class="offset-8">
                            <img t-att-src="image_data_uri(o.signature)" style="max-height: 4cm; max-width: 8cm;"/>
                        </div>
                        <div t-if="o.partner_id.name" class="offset-8 text-center">
                            <p t-field="o.partner_id.name">John Doe</p>
                        </div>
                    </div>
                </div>
            </t>
         </t>
    </t>